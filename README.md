# Avito Arbitrage Monitor Bot

Telegram-–±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Avito (–∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ—É—Ç–±—É–∫–æ–≤), –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä—ã–Ω–∫–∞ –∏ –ø–æ–∏—Å–∫–∞ –≤—ã–≥–æ–¥–Ω—ã—Ö –ª–æ—Ç–æ–≤ –ø–æ–¥ —Å—Ö–µ–º—É: **–ø–æ–∫—É–ø–∫–∞ ‚Üí —Ä–µ–º–æ–Ω—Ç ‚Üí
–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∞**.

------------------------------------------------------------------------

# üìå –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π:

1.  –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –Ω–æ—É—Ç–±—É–∫–æ–≤.
2.  –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä—ã–Ω–∫–∞ (p25 / p50 / p75).
3.  –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.
4.  –†–∞—Å—á–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏.
5.  –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –≤ Telegram.
6.  –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ª–æ—Ç–æ–≤ –∏–∑ –æ—Ç—á–µ—Ç–æ–≤.
7.  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ ¬´–º—è–≥–∫–∏–π¬ª –ø–∞—Ä—Å–∏–Ω–≥ –±–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

------------------------------------------------------------------------

# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

Telegram Bot (aiogram) ‚Üí Scheduler (APScheduler) ‚Üí Poller
(incremental_poll_all) ‚Üí AvitoClient (aiohttp) ‚Üí HTML Parser ‚Üí Relevance
Filter ‚Üí Heuristics Engine ‚Üí Report Builder (HTML v2) ‚Üí PostgreSQL

------------------------------------------------------------------------

# üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

    src/
     ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
     ‚îú‚îÄ‚îÄ scheduler.py         # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
     ‚îú‚îÄ‚îÄ bot/
     ‚îÇ    ‚îú‚îÄ‚îÄ router.py       # Telegram –∫–æ–º–∞–Ω–¥—ã
     ‚îÇ    ‚îî‚îÄ‚îÄ keyboards.py
     ‚îú‚îÄ‚îÄ jobs/
     ‚îÇ    ‚îî‚îÄ‚îÄ poller.py       # –õ–æ–≥–∏–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
     ‚îú‚îÄ‚îÄ avito/
     ‚îÇ    ‚îú‚îÄ‚îÄ client.py       # HTTP-–∫–ª–∏–µ–Ω—Ç
     ‚îÇ    ‚îî‚îÄ‚îÄ parser.py       # –ü–∞—Ä—Å–∏–Ω–≥ HTML
     ‚îú‚îÄ‚îÄ analysis/
     ‚îÇ    ‚îú‚îÄ‚îÄ relevance.py    # –§–∏–ª—å—Ç—Ä –º–æ–¥–µ–ª–µ–π
     ‚îÇ    ‚îú‚îÄ‚îÄ heuristics.py   # –†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ –∏ score
     ‚îÇ    ‚îú‚îÄ‚îÄ report.py       # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
     ‚îÇ    ‚îî‚îÄ‚îÄ report_fmt.py   # HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
     ‚îú‚îÄ‚îÄ db/
     ‚îÇ    ‚îú‚îÄ‚îÄ repo.py         # –†–∞–±–æ—Ç–∞ —Å –ë–î
     ‚îÇ    ‚îî‚îÄ‚îÄ ddl.py          # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

------------------------------------------------------------------------

# üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## –¢–∞–±–ª–∏—Ü–∞ searches

–•—Ä–∞–Ω–∏—Ç –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–º–æ–¥–µ–ª–∏):

-   id
-   query
-   created_at
-   last_polled_at

## –¢–∞–±–ª–∏—Ü–∞ items

–•—Ä–∞–Ω–∏—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è:

-   id
-   search_id
-   external_id
-   url
-   title
-   description
-   price
-   city
-   seller_type
-   photos_count
-   raw (JSON)
-   first_seen_at
-   last_seen_at
-   reported_at (–¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥—É–±–ª–µ–π –≤ –æ—Ç—á–µ—Ç–∞—Ö)

------------------------------------------------------------------------

# üîç –õ–æ–≥–∏–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –ü–µ—Ä–≤–∏—á–Ω—ã–π —Å–±–æ—Ä (/add)

-   –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
-   –ü—Ä–æ—Ö–æ–¥ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
-   –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ª–æ—Ç–æ–≤
-   –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
-   –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞

## –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

-   –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
-   –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —á–∞—Å—Ç–∏—á–Ω–æ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
-   –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –ª–æ—Ç–æ–≤
-   –û—Ç—á–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –Ω–æ–≤—ã–º
-   –ü–æ–º–µ—Ç–∫–∞ reported_at

------------------------------------------------------------------------

# üß† –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

-   –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∫–æ–¥ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä t480)
-   –í –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –æ–±—è–∑–∞–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–æ–¥
-   –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥—Ä—É–≥–∏—Ö –∫–æ–¥–æ–≤ (t490, p43s –∏ —Ç.–¥.) –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
    –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

------------------------------------------------------------------------

# üìä –†—ã–Ω–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü–æ –∫–∞–∂–¥–æ–º—É –ø–æ–∏—Å–∫—É —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:

-   p25
-   p50 (–º–µ–¥–∏–∞–Ω–∞)
-   p75
-   —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∫–∏

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏.

------------------------------------------------------------------------

# üí∞ –≠–≤—Ä–∏—Å—Ç–∏–∫–∞

Score –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:

-   –î–∏—Å–∫–æ–Ω—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ p50
-   –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤
-   –†–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–±—ã–ª–∏:

```{=html}
<!-- -->
```
    profit_min = p50 - price - max_repair - misc
    profit_max = p50 - price - min_repair - misc

–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–µ—Ñ–µ–∫—Ç–æ–≤ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–ª–æ–≤ –ø–æ–ª–æ–º–∫–∏ —Ä—è–¥–æ–º.

------------------------------------------------------------------------

# üì¨ –û—Ç—á–µ—Ç v2

HTML-–æ—Ç—á–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:

-   –†—ã–Ω–æ—á–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –ª–æ—Ç–æ–≤
-   –¢–æ–ø –ø–æ score/profit
-   –≠–º–æ–¥–∑–∏-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:

üíé –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ñ–∏—Ç\
üî• –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ñ–∏—Ç\
‚úÖ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏—Ç\
üü¢ –≤—ã—Å–æ–∫–∏–π score\
üî¥ –Ω–∏–∑–∫–∏–π score

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ Telegram.

------------------------------------------------------------------------

# üõ° –ê–Ω—Ç–∏–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

-   –ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
-   –ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–∏—Å–∫–∞–º–∏
-   max_instances=1
-   1 HTTP session –Ω–∞ –ø–æ–∏—Å–∫
-   Retry + backoff –ø—Ä–∏ 429
-   –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
-   Desktop User-Agent
-   Accept-Language ru-RU

------------------------------------------------------------------------

# ‚öôÔ∏è .env

    BOT_TOKEN=
    DATABASE_URL=
    NOTIFY_CHAT_ID=

    POLL_INTERVAL_MIN=15
    MAX_PAGES=10
    PAGE_DELAY_S=4
    BETWEEN_SEARCH_DELAY_S=80
    HTTP_TIMEOUT_S=30
    USER_AGENT=

------------------------------------------------------------------------

# üöÄ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è

-   –†–∞–∑–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ¬´–ø–æ–¥ —Ä–µ–º–æ–Ω—Ç¬ª / ¬´—Ä–∞–±–æ—á–∏–µ¬ª
-   –û–±—É—á–∞–µ–º—ã–π —Å–∫–æ—Ä–∏–Ω–≥
-   –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
-   –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
-   –ü—Ä–æ–∫—Å–∏ / IP rotation
-   –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π (T480 vs T480s)

------------------------------------------------------------------------

# üìé –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –Ω–æ–≤–æ–º —á–∞—Ç–µ

–ü—Ä–æ—Å—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —ç—Ç–æ—Ç README –∏ –Ω–∞–ø–∏—Å–∞—Ç—å:

¬´–•–æ—á—É —É–ª—É—á—à–∏—Ç—å —ç–≤—Ä–∏—Å—Ç–∏–∫—É¬ª\
¬´–î–æ–±–∞–≤–∏–º –ø—Ä–æ–∫—Å–∏¬ª\
¬´–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É¬ª

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ —É–∂–µ –±—É–¥–µ—Ç –ø–æ–Ω—è—Ç–µ–Ω.
